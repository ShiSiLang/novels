<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="icon" type="icon" href="https://i.imgur.com/XjWCCeV.png" />
    <title>LonelyBall Media</title>
    <meta property="og:title" content="Review Page" />
    <meta property="og:site_name" content="LonelyBall Media" />
    <meta property="og:description"
        content="Welcome to LonelyBall Media! We have a great selection of graphic novels and stories for you to read. Dive into our imaginative worlds and enjoy reading our engaging books." />
    <meta property="og:image" content="https://i.imgur.com/XjWCCeV.png" />
    <meta name="theme-color" content="#cbc3e3" />
    <meta name="twitter:card" content="summary_large_image" />
    <link rel="stylesheet" href="https://site-assets.fontawesome.com/releases/v6.1.1/css/all.css" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" />
</head>
<link href="https://fonts.googleapis.com/css?family=Nunito" rel="stylesheet" />
<style>
        body {  
      background-size: 400% 400%;  
      margin: 0;  
      background-color: #121212;  
      font-family: 'Nunito';  
      font-size: 22px;  
    }  
  
    .flex {  
      display: flex;  
      justify-content: center;  
    }  
  
  .topnav {  
    background-color: #2196F3;  
    overflow: hidden;  
  }  
  
  /* Style the links inside the navigation bar */  
  .topnav a {  
    float: left;  
    display: block;  
    color: #ffffff;  
    text-align: center;  
    padding: 14px 16px;  
    text-decoration: none;  
    font-size: 17px;  
  }  
  
  /* Change the color of links on hover */  
  .topnav a:hover {  
    background-color: #1976D2;  
    color: #ffffff;  
  }  
  
  .topnav a.active {  
    background-color: #1976D2;  
    color: white;  
  }  
  
  /* Hide the link that should open and close the topnav on small screens */  
  .topnav .icon {  
    display: none;  
  }  
  
  @media screen and (max-width: 600px) {  
    .topnav a:not(:first-child) {display: none;}  
    .topnav a.icon {  
      float: right;  
      display: block;  
    }  
  }  
  
  /* The "responsive" class is added to the topnav with JavaScript when the user clicks on the icon. This class makes the topnav look good on small screens (display the links vertically instead of horizontally) */  
  @media screen and (max-width: 600px) {  
    .topnav.responsive {position: relative;}  
    .topnav.responsive a.icon {  
      position: absolute;  
      right: 0;  
      top: 0;  
    }  
    .topnav.responsive a {  
      float: none;  
      display: block;  
      text-align: left;  
    }  
  }  
  
    .text {  
      margin-bottom: 25px;  
    }  
  
   .text h1 {  
      text-align: center;  
      color: #2196F3;  
    }  
  
    .text p {  
      text-align: center;  
      color: #FFFFFF;  
    }


    /*Buttons*/

    button {
        text-align: center;
        font-weight: bold;
        text-decoration: none;
        font-family: 'Nunito';
        display: inline-block;
        border-radius: 16px;
        background-color: #2196F3
        cursor: pointer;
        padding: 20px;
        font-size: 30px;
        color: white;
        margin: auto;
    }

    button:hover {
        background-color: #1976D2;
        transition: 1s;
    }

    button:disabled {
        cursor: not-allowed;
        pointer-events: all !important;
    }

    .submit {
        cursor: pointer;
        padding: 14px 20px;
        background-color: #c499cc;
        color: white;
        float: left;
        width: 100%;
    }

    /*Buttons End*/

    /* modal*/
    * {
        box-sizing: border-box
    }

    /* Full-width input fields */

    label {
        color: white
    }

    input[type=file] {
        width: 100%;
        padding: 15px;
        margin: 5px 0 22px 0;
    }

    input[type=text],
    input[type=password] {
        width: 100%;
        padding: 15px;
        margin: 5px 0 22px 0;
        display: inline-block;
        border: none;
        background: transparent;
    }

    input[type=text]:focus,
    input[type=password]:focus {
        border: 3px solid #956a9d;
        border-radius: 16px;
        color: black;
        outline: none;
    }

    select {
        width: 100%;
        padding: 15px;
        margin: 5px 0 22px 0;
        background: transparent;
        border: none;
        color: #ffcc99;
        outline: none;
    }

    select:focus {
        border: 3px solid #956a9d;
        border-radius: 16px;
        color: #ffcc99;
    }

    .IDS {
        border-radius: 16px;
        width: 75%;
        background-color: #956a9d;
        color: #FFFF;
    }

    ::placeholder {
        color: black;
    }

    hr {
        border: 1px solid #f1f1f1;
        margin-bottom: 25px;
    }

    /* Add padding to container elements */
    .container {
        background-color: #c499cc;
        border-radius: 16px;
        padding: 16px;
        margin: 20px;
    }

    .container h1,
    p {
        color: white
    }


    /* Clear floats */
    .clearfix::after {
        content: "";
        clear: both;
        display: table;
    }

    /* Change styles for cancel button and signup button on extra small screens */
    @media screen and (max-width: 300px) {

        .cancelbtn,
        .signupbtn {
            width: 100%;
        }
    }

    /*new modal end*/

    .alert {
        padding: 20px;
        background-color: #f44336;
        color: white;
        margin-bottom: 15px;
        display: none;
    }

    .alert.success {
        background-color: #04AA6D;
    }

    .alert.info {
        background-color: #2196F3;
    }

    .alert.warning {
        background-color: #ff9800;
    }

    .closebtn {
        margin-left: 15px;
        color: white;
        font-weight: bold;
        float: right;
        font-size: 22px;
        line-height: 20px;
        cursor: pointer;
        transition: 0.3s;
    }

    .closebtn:hover {
        color: black;
    }

    .review-container {
        display: flex;
        flex-direction: column;
        border: 1px solid #ccc;
        margin: 10px;
        padding: 10px;
    }

    .review-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 10px;
    }

    .review-type {
        margin: 0;
        color: #2196F3;
    }

    .review-id {
        margin: 0;
        font-size: 14px;
        color: #2196F3;
    }

    .image-container {
        width: 200px;
        height: 300px;
        margin-right: 20px;
        overflow: hidden;
    }

    .review-image {
        width: 100%;
    }

    .review-title {
        margin-top: 0;
        color: #2196F3;
    }

    .review-description {
  margin: 10px 0;
  overflow-y: auto;
  max-height: 300px; /* Set the maximum height for the scrollable area */
}


    .review-author {
        margin: 10px 0;
        font-weight: bold;
    }
</style>

<body>
      <div class="topnav" id="myTopnav">  
    <a href="/home"><i class="fa-solid fa-house"></i> Home</a>  
    <a href="/explore"><i class="fa-solid fa-magnifying-glass"></i> Explore</a>  
  
  <a id="account" href="#"><i class="fa-solid fa-user"></i> My Account</a>  
          <a id="toggle" href="#"><i class="fa-solid fa-arrow-right-from-bracket"></i> Sign Out</a>  
  
     <a href="https://cash.app/$PerezDeDios" target="_blank"><i class="fa-solid fa-coins"></i> Donate</a>  
    <a href="javascript:void(0);" class="icon" onclick="myFunction()">  
      <i class="fa-solid fa-bars"></i>  
    </a>  
  </div>  
  
  <script>  
  function myFunction() {  
    var x = document.getElementById("myTopnav");  
    if (x.className === "topnav") {  
      x.className += " responsive";  
    } else {  
      x.className = "topnav";  
    }  
  }  
  </script>  
  
      <script>   
           document.getElementById("toggle").addEventListener("click", async (e) => {  
               if (e.target.innerText === " Sign Out") {   
                   alert("Signing you out!");   
                   localStorage.removeItem("user");   
                   window.location.reload();   
               }   
           });   
       </script>   
  
       <script>   
           if (typeof Storage !== "undefined") {   
               if (localStorage.user) {   
                   let data = JSON.parse(localStorage.user);   
      document.getElementById("account").href = `/profile/${data.id}`;   
               } else {   
      document.getElementById("toggle").innerHTML = '<i class="fa-solid fa-right-to-bracket"></i> Sign In';   
                   document.getElementById("toggle").href = "/access-portal";   
               }   
           } else {   
               document.getElementById("toggle").innerHTML = "<span>&empty;</span>";   
               document.getElementById("account").innerHTML = "<span>&empty;</span>";   
           }   
       </script>

    <div class="flex">
        <select class="IDS" name="reviewIds" id="reviewIds"></select>
    </div>

    <div class="review-container">
        <div class="review-header">
            <h2 class="review-type"></h2>
            <p class="review-id"></p>
        </div>
        <div class="review-details">
            <div class="image-container">
                <img src="" alt="" class="review-image">
            </div>
            <div class="review-text">
                <h3 class="review-title"></h3>
                <p class="review-description"></p>
                <p class="review-author"></p>
            </div>
        </div>
    </div>

    <script>
        updateSelect()
        async function updateSelect() {
            try {
                let response = await fetch(`https://novels-production.up.railway.app/data/reviews/null`);
                let json = await response.json();

                var options = json.map(v => {
                    return {
                        "text": v.reviewID,
                        "value": v.reviewID
                    }
                });

                var selectBox = document.getElementById('reviewIds');

                for (var i = 0, l = options.length; i < l; i++) {
                    var option = options[i];
                    selectBox.options.add(new Option(option.text, option.value, option.selected));
                }
            } catch (err) { console.log(err) }
        }
    </script>

    <script>
        const selectElement = document.getElementById('reviewIds');

        selectElement.addEventListener('change', async () => {
            const selectedValue = selectElement.value;
            let response = await fetch(`https://novels-production.up.railway.app/data/reviews/null`);
            let json = await response.json();

            let reviewData = json.find(v => v.reviewID === selectedValue)
            const typeElement = document.querySelector('.review-type');
            const idElement = document.querySelector('.review-id');
            const imageElement = document.querySelector('.review-image');
            const titleElement = document.querySelector('.review-title');
            const descriptionElement = document.querySelector('.review-description');
            const authorElement = document.querySelector('.review-author');

            if (reviewData.type === "Book") {
                imageElement.src = reviewData.book.icon;
                typeElement.textContent = reviewData.type;
                idElement.textContent = `ID: ${reviewData.reviewID}`;
                titleElement.textContent = reviewData.book.name;
                descriptionElement.textContent = reviewData.book.description;
                authorElement.textContent = reviewData.book.author;
            }

            if (reviewData.type === "Chapter") {
imageElement.style.display = 'none';

                typeElement.textContent = reviewData.type;
                idElement.textContent = `ID: ${reviewData.reviewID}`;
                titleElement.textContent = reviewData.book.name;
                descriptionElement.textContent = formatString(reviewData.chapter.novel);
                authorElement.textContent = reviewData.book.author;
            }
        });

      function formatString(content) { 
         let step1 = content 
           .split(" ") 
           .join(" ") 
           .replaceAll("\n", "</br>") 
           .replaceAll("\n\n", "</br></br>"); 
         let step2 = step1.replaceAll(/\*\*(.*?)\*\*/g, "<b>$1</b>"); 
         let step3 = step2.replaceAll(/\*(.*?)\*/g, "<em>$1</em>"); 
         let step4 = step3.replaceAll(/\_(.*?)\_/g, "<ins>$1</ins>"); 
         return step4; 
       }   
    </script>

    <form id="FormReview" action="/review" method="post">
        <div class="container">
            <h1>Review</h1>
            <p>Please fill in this form to review an book/chapter.</p>
            <hr />

            <label for="type"><b>Step 1</b></label>
            <select name="type" id="type" form="FormReview" required>
                <option value="accept">Accept</option>
                <option value="decline">Decline</option>
            </select>

            <label for="type2"><b>Step 2</b></label>
            <select name="type2" id="type2" form="FormReview" required>
                <option value="Book">Book</option>
                <option value="Chapter">Chapter</option>
            </select>

            <label for="reviewID"><b>Review ID</b></label>
            <input type="text" placeholder="Enter Review ID" name="reviewID" required autocomplete="off" />

            <label for="password"><b>Password</b></label>
            <input type="password" placeholder="Enter Password" name="password" required />

            <p>Only staff are authorized to use this.</p>

            <div class="clearfix">
                <button id="submit" type="submit" class="submit">Submit</button>
            </div>
        </div>
    </form>

    <div id="error" class="alert">
        <span class="closebtn" onclick="this.parentElement.style.display='none';">&times;</span>
        Error.
    </div>

    <div id="success" class="alert success">
        <span class="closebtn" onclick="this.parentElement.style.display='none';">&times;</span>
        <strong>Success!</strong> Yay.
    </div>
    
    <script>
        const form = document.getElementById("FormReview");
        const error = document.getElementById("error");
        const success = document.getElementById("success");

        form.addEventListener("submit", async (e) => {
            e.preventDefault();
            document.getElementById("submit").disabled = true;

            const data = Object.fromEntries(new FormData(form).entries());

            const response = await fetch("/review", {
                method: "POST",
                headers: {
                    "Content-Type": "application/json",
                },
                body: JSON.stringify({ data }),
            });

            if (response.ok) {
                // Display success message here
                const successData = await response.json();
                success.innerHTML = `<span class="closebtn" onclick="this.parentElement.style.display='none';">&times;</span>
            <strong>Success!</strong> ${successData.success}`;
                success.style.display = "block";
                document.getElementById("submit").disabled = false;
            } else {
                const errorData = await response.json();
                error.innerHTML = `<span class="closebtn" onclick="this.parentElement.style.display='none';">&times;</span>
        ${errorData.error}`;
                error.style.display = "block";
                document.getElementById("submit").disabled = false;
            }
        });
    </script>
</body>

</html>