<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="icon" type="icon" href="https://i.imgur.com/XjWCCeV.png" />
    <title>$$username$$'s profile</title>
    <meta property="og:title" content="$$username$$" />
    <meta property="og:site_name" content="LonelyBall Media" />
    <meta property="og:description" content="View $$username$$'s profile." />
    <meta property="og:image" content="$$avatar$$" />
    <meta name="theme-color" content="#cbc3e3" />
    <meta name="twitter:card" content="summary_large_image" />
    <link rel="stylesheet" href="https://site-assets.fontawesome.com/releases/v6.1.1/css/all.css" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" />
</head>
<link href="https://fonts.googleapis.com/css?family=Nunito" rel="stylesheet" />
<style>
      body { 
     background-size: 400% 400%; 
     margin: 0; 
     background-color: #121212; 
     font-family: 'Nunito'; 
     font-size: 22px; 
   } 
  
   .flex { 
     display: flex; 
     justify-content: center; 
   } 
  
 .topnav { 
   background-color: #2196F3; 
   overflow: hidden; 
 } 
  
 /* Style the links inside the navigation bar */ 
 .topnav a { 
   float: left; 
   display: block; 
   color: #ffffff; 
   text-align: center; 
   padding: 14px 16px; 
   text-decoration: none; 
   font-size: 17px; 
 } 
  
 /* Change the color of links on hover */ 
 .topnav a:hover { 
   background-color: #1976D2; 
   color: #ffffff; 
 } 
  
 .topnav a.active { 
   background-color: #1976D2; 
   color: white; 
 } 
  
 /* Hide the link that should open and close the topnav on small screens */ 
 .topnav .icon { 
   display: none; 
 } 
  
 @media screen and (max-width: 600px) { 
   .topnav a:not(:first-child) {display: none;} 
   .topnav a.icon { 
     float: right; 
     display: block; 
   } 
 } 
  
 /* The "responsive" class is added to the topnav with JavaScript when the user clicks on the icon. This class makes the topnav look good on small screens (display the links vertically instead of horizontally) */ 
 @media screen and (max-width: 600px) { 
   .topnav.responsive {position: relative;} 
   .topnav.responsive a.icon { 
     position: absolute; 
     right: 0; 
     top: 0; 
   } 
   .topnav.responsive a { 
     float: none; 
     display: block; 
     text-align: left; 
   } 
 } 
  
  
   .text { 
     margin-bottom: 25px; 
   } 
  
  .text h1 { 
     text-align: center; 
     color: #2196F3; 
   } 
  
   .text p { 
     text-align: center; 
     color: #FFFFFF; 
   }

    /*Profile Start*/
    .profile {
        max-width: 100%;
        text-align: center;
        color: white;
    }

    .profile .images {
        max-width: 100%;
        position: relative;
        margin-bottom: 10px;
    }

    .images .banner {
        width: 100%;
        max-height: 450px;
    }

@media (min-width: 1024px) {
  /* Styles for PC or desktop devices */
  .images .banner {
            max-height: 150px;
        }
}

    .images .avatar {
        width: 30%;
        border-radius: 50%;
        border: 2px solid white;
        position: absolute;
        left: 35%;
        top: 55%;
    }

    .profile .ctext {
        margin-top: 24%;
    }


       .profile .ctext {
            margin-top: 15%;
       }
    }

    .ctext .social {
        margin: 0 auto;
    }

    .social a {
        transition: color .4s ease;
        text-decoration: none;
        color: #2196F3;
    }

    .social a:hover {
        color: white;
    }

    button {
        text-align: center;
        font-weight: bold;
        text-decoration: none;
        font-family: 'Nunito';
        display: inline-block;
        border-radius: 16px;
        background-color: #2196F3;
        cursor: pointer;
        padding: 20px;
        font-size: 30px;
        color: white;
        margin: auto;
    }

    button:hover {
        background-color: #1976D2;
        transition: 1s;
    }

    .cardButton {
        width: 250px;
        margin: 10px;
        margin-top: 25px;
        text-align: center;
        padding: 5px;
    }

    /*User Card End*/

    /*Search Bar*/
    * {
        box-sizing: border-box;
    }

    .wrapper {
        max-width: 450px;
        margin: 150px auto;
    }

    .wrapper .search-input {
        border-radius: 16px;
        box-shadow: 0px 0px 10px #956a9d;
        background-color: #c499cc;
        border: 3px solid #956a9d;
        width: 100%;
        position: relative;
    }

    .search-input input {
        height: 55px;
        width: 100%;
        outline: none;
        border-radius: 16px;
        box-shadow: 0px 0px 10px #956a9d;
        background-color: #c499cc;
        border: none;
        padding: 0 60px 0 20px;
        font-size: 22px;
    }

    .search-input.active input {
        border-radius: 5px 5px 0 0;
    }

    .search-input .autocom-box {
        padding: 0;
        opacity: 0;
        pointer-events: none;
        max-height: 280px;
        overflow-y: auto;
    }

    .search-input.active .autocom-box {
        padding: 10px 8px;
        opacity: 1;
        pointer-events: auto;
    }

    .autocom-box li {
        list-style: none;
        padding: 8px 12px;
        display: none;
        width: 100%;
        cursor: default;
        border-radius: 3px;
    }

    .search-input.active .autocom-box li {
        display: block;
    }

    .autocom-box li:hover {
        background: #d1dada;
    }

    .search-input .icon {
        position: absolute;
        right: 0px;
        top: 0px;
        height: 55px;
        width: 55px;
        text-align: center;
        line-height: 55px;
        font-size: 20px;
        color: white;
        cursor: pointer;
    }

    /*Search Bar End*/

    /*Modal*/

    .submitbtn {
        width: auto;
        background-color: #c499cc;
        padding: 14px 20px;
        margin: 8px 0;
        cursor: pointer;
        width: 100%;
        color: white;
    }

    .container {
        padding: 16px;
        background-color: #c499cc;
        border-radius: 16px;
    }

    .container label {
        color: #ffcc99;
    }

    .container input {
        width: 100%;
        padding: 12px 20px;
        margin: 8px 0;
        display: inline-block;
        box-sizing: border-box;
        background: transparent;
        border: none;
        color: #ffcc99;
        outline: none;
    }

    .container input:focus {
        border: 3px solid #956a9d;
        border-radius: 16px;
        color: #ffcc99;
    }

    .autocomplete {
        /*the container must be positioned relative:*/
        position: relative;
        display: inline-block;
    }

    .autocomplete-items {
        position: absolute;
        border: 1px solid #ffcc99;
        border-bottom: none;
        border-top: none;
        z-index: 99;
        top: 100%;
        left: 0;
        right: 0;
    }

    ::placeholder {
        color: #ffcc99;
    }

    .modal {
        display: none;
        position: fixed;
        z-index: 1;
        left: 0;
        top: 0;
        width: 100%;
        height: 100%;
        overflow: auto;
        padding-top: 60px;
    }

    .modal-content {
        color: white;
        margin: 5% auto 15% auto;
        border-radius: 16px;
        box-shadow: 0px 0px 10px #956a9d;
        background-color: #c499cc;
        border: 3px solid #956a9d;
        width: 80%;
    }

    .animate {
        -webkit-animation: animatezoom 0.6s;
        animation: animatezoom 0.6s
    }

    @-webkit-keyframes animatezoom {
        from {
            -webkit-transform: scale(0)
        }

        to {
            -webkit-transform: scale(1)
        }
    }

    @keyframes animatezoom {
        from {
            transform: scale(0)
        }

        to {
            transform: scale(1)
        }
    }

    @media screen and (max-width: 300px) {
        span.psw {
            display: block;
            float: none;
        }

        .submitbtn {
            width: 100%;
        }
    }

    /*Modal End*/

    .alert {
        padding: 20px;
        background-color: #f44336;
        color: white;
        margin-bottom: 15px;
        display: none;
    }

    .alert.success {
        background-color: #04AA6D;
    }

    .alert.info {
        background-color: #2196F3;
    }

    .alert.warning {
        background-color: #ff9800;
    }

    .closebtn {
        margin-left: 15px;
        color: white;
        font-weight: bold;
        float: right;
        font-size: 22px;
        line-height: 20px;
        cursor: pointer;
        transition: 0.3s;
    }

    .closebtn:hover {
        color: black;
    }

    /*Media Scroller Start*/
    .media-scroller {
        --gap: 16px;

        box-sizing: border-box;
        padding: var(--gap);
        display: grid;
        grid-auto-flow: column;
        grid-auto-columns: 21%;
        gap: var(--gap);

        overflow-x: auto;
        overscroll-behavior-inline: contain;
        overflow-y: hidden;
    }

    .media-scroller img {
        border-radius: 16px;
        width: 100%;
        height: 100%;
        object-fit: cover;
    }

    .snaps-inline {
        scroll-snap-type: inline mandatory;
        scroll-padding-inline: var(--gap);
    }

    .snaps-inline>* {
        scroll-snap-align: start;
    }

    .media-scroller img:hover {
        cursor: pointer;
        opacity: 0.5;
        transition: 0.5s;
    }

    /*Media Scroller End*/
</style>

<body>
       <div class="topnav" id="myTopnav">  
    <a href="/home"><i class="fa-solid fa-house"></i> Home</a>  
    <a href="/explore"><i class="fa-solid fa-magnifying-glass"></i> Explore</a>  
  
  <a id="account" href="#" class="active"><i class="fa-solid fa-user"></i> My Account</a>  
          <a id="toggle" href="#"><i class="fa-solid fa-arrow-right-from-bracket"></i> Sign Out</a>  
  
     <a href="https://cash.app/$PerezDeDios" target="_blank"><i class="fa-solid fa-coins"></i> Donate</a>  
    <a href="javascript:void(0);" class="icon" onclick="myFunction()">  
      <i class="fa-solid fa-bars"></i>  
    </a>  
  </div>  
  
  <script>  
  function myFunction() {  
    var x = document.getElementById("myTopnav");  
    if (x.className === "topnav") {  
      x.className += " responsive";  
    } else {  
      x.className = "topnav";  
    }  
  }  
  </script>  
  
      <script>   
           document.getElementById("toggle").addEventListener("click", async (e) => {  
               if (e.target.innerText === " Sign Out") {   
                   alert("Signing you out!");   
                   localStorage.removeItem("user");   
                   window.location.reload();   
               }   
           });   
       </script>   
  
       <script>   
           if (typeof Storage !== "undefined") {   
               if (localStorage.user) {   
                   let data = JSON.parse(localStorage.user);   
      document.getElementById("account").href = `/profile/${data.id}`;   
               } else {   
      document.getElementById("toggle").innerHTML = '<i class="fa-solid fa-right-to-bracket"></i> Sign In';   
                   document.getElementById("toggle").href = "/access-portal";   
               }   
           } else {   
               document.getElementById("toggle").innerHTML = "<span>&empty;</span>";   
               document.getElementById("account").innerHTML = "<span>&empty;</span>";   
           }   
       </script>

    <div class="profile">
        <div class="images">
            <img class="banner" src="$$banner$$" alt="User Banner" />
            <img class="avatar" src="$$avatar$$" alt="User Avatar" />
        </div>
        <div class="ctext">
            <h1 style="color:#2196F3;">$$username$$</h1>
            <h2>$$bio$$</h2>
            <h3>Followers: $$followers$$</h3>
            <h3>Comments: $$comments$$</h3>
            <h3>Joined: $$date$$</h3>
            <div class="social">
                <a href="$$discord$$"><i class="fa fa-discord"></i></a>
                <a href="$$twitter$$"><i class="fa fa-twitter"></i></a>
            </div>
            <div class="flex">
                <button class="cardButton" id="epb" onclick="document.getElementById('id01').style.display='block'">
                    Edit Profile
                </button>
                <button class="cardButton" id="fpb">Follow Profile</button>
            </div>
        </div>
    </div>

<hr style="height:6px;border-width:0;color:#2196F3;background-color:#2196F3"> 
 <hr style="height:6px;border-width:0;color:#2196F3;background-color:#2196F3;margin-top:10px">

    <div class="text">
        <h1><i class="fa-solid fa-books"></i> My Books</h1>
    </div>

    <div id="myBooks" class="media-scroller snaps-inline"></div>

<div class="text">
        <h1><i class="fa-solid fa-books"></i> My Favorites</h1>
    </div>

    <div id="myFavorites" class="media-scroller snaps-inline"></div>

    <script>
        myBooks();
        async function myBooks() {
            try {
                let response = await fetch(
                    "https://novels-production.up.railway.app/data/profilebooks/$$userID$$"
                );
                let books = await fetch(
                    "https://novels-production.up.railway.app/data/books/null"
                );
                let json = await response.json();
                let bookjson = await books.json();

                let newArray = bookjson.filter((v) => json.includes(v.name));
                const myBooks = document.getElementById("myBooks");

                for (i = 0; i < newArray.length; i++) {
                    myBooks.innerHTML += `<a href="https://novels-production.up.railway.app/explore/${newArray[i].name}"><img src="${newArray[i].icon}" alt="${newArray[i].name}"></a>`;
                }
            } catch (err) {
                console.log(err);
                alert("Could not fetch data.");
            }
        }
    </script>

    <div id="id01" class="modal">
        <form class="modal-content animate" id="FormEdit" action="/edit" method="post">
            <div class="container">
                <input id="user" type="hidden" name="user" value="NOTHING" />
                <label for="discord"><b>Edit Discord Link</b></label>
                <input type="text" placeholder="Enter new discord" name="discord" autocomplete="off" />
                <label for="twitter"><b>Edit Twitter Link</b></label>
                <input type="text" placeholder="Enter new twitter" name="twitter" autocomplete="off" />
                <label for="twitter"><b>Edit Bio</b></label>
                <input type="text" placeholder="Enter new bio" name="bio" autocomplete="off" />
            </div>
            <div class="container">
                <button type="submit" onclick="document.getElementById('id01').style.display='none'" class="submitbtn">
                    Edit Profile
                </button>
            </div>
        </form>
    </div>

    <div id="error" class="alert">
        <span class="closebtn" onclick="this.parentElement.style.display='none';">&times;</span>
        Error.
    </div>

    <div id="success" class="alert success">
        <span class="closebtn" onclick="this.parentElement.style.display='none';">&times;</span>
        <strong>Success!</strong> Yay.
    </div>

    <script>
        if (typeof Storage !== "undefined") {
            if (localStorage.user) {
                let data = JSON.parse(localStorage.user);
                if (data.username === "$$username$$") {
                    document.getElementById("fpb").style.display = "none";
                    let userObject = JSON.stringify({ username: data.username, id: data.id, email: data.email, password: data.password })
                    document.getElementById("user").value = userObject;
                } else {
                    document.getElementById("epb").style.display = "none";
                }
            } else {
                document.getElementById("epb").style.display = "none";
                document.getElementById("fpb").style.display = "none";
            }
        } else {
            document.getElementById("epb").style.display = "none";
            document.getElementById("fpb").style.display = "none";
        }
    </script>

    <script>
        const button = document.getElementById("fpb");
        let data = JSON.parse(localStorage.user);
        button.addEventListener("click", async (_) => {
            const response = await fetch("/follow-profile", {
                method: "POST",
                headers: {
                    "Content-Type": "application/json",
                },
                body: JSON.stringify({
                    id: data.id,
                    username: data.username,
                    email: data.email,
                    password: data.password,
                    follow: "$$userID$$",
                }),
            });

            if (response.ok) {
                // Display success message here
                const successData = await response.json();
                success.innerHTML = `<span class="closebtn" onclick="this.parentElement.style.display='none';">&times;</span>
    <strong>Success!</strong> ${successData.success}`;
                success.style.display = "block";
            } else {
                const errorData = await response.json();
                error.innerHTML = `<span class="closebtn" onclick="this.parentElement.style.display='none';">&times;</span>
${errorData.error}`;
                error.style.display = "block";
            }
        });
    </script>

    <script>
        var modal = document.getElementById("id01");
        window.onclick = function (event) {
            if (event.target === modal) {
                modal.style.display = "none";
            }
        };
    </script>

    <script>
        const form = document.getElementById("FormEdit");
        const error = document.getElementById("error");
        const success = document.getElementById("success");

        form.addEventListener("submit", async (e) => {
            e.preventDefault();

            const formData = new FormData(form);

            const response = await fetch("/edit-profile", {
                method: "POST",
                body: formData,
            });

            if (response.ok) {
                // Display success message here
                const successData = await response.json();
                success.innerHTML = `<span class="closebtn" onclick="this.parentElement.style.display='none';">&times;</span>
        <strong>Success!</strong> ${successData.success}`;
                success.style.display = "block";
            } else {
                const errorData = await response.json();
                error.innerHTML = `<span class="closebtn" onclick="this.parentElement.style.display='none';">&times;</span>
    ${errorData.error}`;
                error.style.display = "block";
            }
        });
    </script>

    <script>
        document.onkeydown = function (e) {
            const { keyCode: c } = e;
            if (e.ctrlKey) {
                switch (c) {
                    case 83:
                    case 85:
                    case 65:
                    case 73:
                    case 123:
                        e.preventDefault();
                        break;
                }
            } else {
                if (c === 123) e.preventDefault();
            }
        };
        window.addEventListener(
            "contextmenu",
            function (e) {
                e.preventDefault();
            },
            false
        );
    </script>
</body>

</html>