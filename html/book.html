<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link rel="icon" type="icon" href="$$icon$$" />
  <title>LonelyBall Media</title>
  <meta property="og:title" content="$$name$$" />
  <meta property="og:site_name" content="LonelyBall Media" />
  <meta property="og:description" content="$$desc$$" />
  <meta property="og:image" content="$$icon$$" />
  <meta name="theme-color" content="#cbc3e3" />
  <meta name="twitter:card" content="summary_large_image" />
  <link rel="stylesheet" href="https://site-assets.fontawesome.com/releases/v6.1.1/css/all.css" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" />
</head>
<link href="https://fonts.googleapis.com/css?family=Nunito" rel="stylesheet" />
<style>
  body {
    background-size: 400% 400%;
    margin: 0;
    background-color: #121212;
    font-family: 'Nunito';
    font-size: 22px;
  }

  .flex {
    display: flex;
    justify-content: center;
  }

  .topnav {
    background-color: #2196F3;
    overflow: hidden;
  }

  /* Style the links inside the navigation bar */
  .topnav a {
    float: left;
    display: block;
    color: #ffffff;
    text-align: center;
    padding: 14px 16px;
    text-decoration: none;
    font-size: 17px;
  }

  /* Change the color of links on hover */
  .topnav a:hover {
    background-color: #1976D2;
    color: #ffffff;
  }

  .topnav a.active {
    background-color: #1976D2;
    color: white;
  }

  /* Hide the link that should open and close the topnav on small screens */
  .topnav .icon {
    display: none;
  }

  @media screen and (max-width: 600px) {
    .topnav a:not(:first-child) {
      display: none;
    }

    .topnav a.icon {
      float: right;
      display: block;
    }
  }

  /* The "responsive" class is added to the topnav with JavaScript when the user clicks on the icon. This class makes the topnav look good on small screens (display the links vertically instead of horizontally) */
  @media screen and (max-width: 600px) {
    .topnav.responsive {
      position: relative;
    }

    .topnav.responsive a.icon {
      position: absolute;
      right: 0;
      top: 0;
    }

    .topnav.responsive a {
      float: none;
      display: block;
      text-align: left;
    }
  }


  .text {
    margin-bottom: 25px;
  }

  .text h1 {
    text-align: center;
    color: #2196F3;
  }

  .text p {
    text-align: center;
    color: #FFFFFF;
  }

  .container {
    justify-content: center;
    align-items: center;
    height: 100%;
    background-color: #2196F3;
    padding: 5px;
  }

  .text-container {
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    text-align: center;
    color: #fff;
    margin-right: 20px;
  }

  .title {
    font-size: 24px;
    font-weight: bold;
    margin-bottom: 10px;
  }

  .description {
    font-size: 18px;
    margin-bottom: 20px;
  }

  .text-inline {
    display: flex;
    flex-direction: column;
    align-items: left;
    text-align: left;
    color: #fff;
    margin-left: 10px;
  }

  .fieldName {
    text-decoration: underline;
    font-size: 40px;
    font-weight: bold;
    margin-bottom: 10px;
  }

  .fieldValue {
    font-size: 25px;
  }

  .rounded-box {
    margin: 10px;
    border-radius: 10px;
    padding: 5px;
    background-color: #1976D2;
    display: flex;
    flex-direction: column;
    align-items: flex-start;
  }

  .content {
    display: flex;
    justify-content: space-between;
    align-items: center;
    width: 100%;
    color: white;
  }

  .left-text {
    font-weight: bold;
  }

  .right-text {
    text-align: right;
    font-weight: bold;
  }


  .mid {
    margin: 0 auto;
  }

  button {
    text-align: center;
    font-weight: bold;
    text-decoration: none;
    font-family: 'Nunito';
    display: inline-block;
    border-radius: 16px;
    border: none;
    background-color: #2196F3;
    cursor: pointer;
    padding: 10px;
    font-size: 30px;
    color: white;
    margin: 0 auto;
  }

  button:hover {
    background-color: #1976D2;
    transition: 1s;
  }

  .favorite-button {
    padding: 10px 24px;
    margin-top: 10px;
    margin-bottom: 10px;
    display: flex;
    align-items: center;
    cursor: pointer;
  }

  .favtext {
    margin-left: 5px;
  }

  hr {
    height: 6px;
    border-width: 0;
    color: #2196F3;
    background-color: #2196F3;
    margin-bottom: 25px;
  }

  * {
    box-sizing: border-box
  }

  .btn-group>button {
    margin: 0 auto;
    margin-bottom: 35px;
    margin-top: 35px;
    text-align: center;
    background-color: #2196F3;

    color: white;
    border-radius: 12px;
    font-size: 16px;
    font-weight: 650;
    text-decoration: none;
    padding: 10px 24px;
    cursor: pointer;
    width: 50%;
    display: block;
  }

  .btn-group button:not(:last-child) {
    border-bottom: none;
  }

  .btn-group button:hover {
    background-color: #1976D2;
  }

  .alert {
    padding: 20px;
    background-color: #2196F3;
    color: white;
    margin-bottom: 15px;
    display: none;
  }

  .alert.success {
    background-color: #2196F3;
  }

  .closebtn {
    margin-left: 15px;
    color: white;
    font-weight: bold;
    float: right;
    font-size: 22px;
    line-height: 20px;
    cursor: pointer;
    transition: 0.3s;
  }

  .closebtn:hover {
    color: black;
  }
</style>
<script type="text/javascript">
  async function changeDivContent() {
    try {
      let response = await fetch($$novel$$);
      let json = await response.json();

      const div = document.getElementById("chapters");
      for (let i = 0; i < json.chapters.length; i++) {
        div.innerHTML += `<button onclick="window.location.href='/read/${json.name
          }/${i + 1}'">${json.chapters[i].name}</button> <hr>`;
      }

      const button = document.getElementById("fb");
      let user = JSON.parse(localStorage.user);
      if (json.followers.includes(user.id)) {
        button.innerHTML = `<span><i class="fa-regular fa-star"></i></span>
  <span class="favtext">Remove from favorites</span>`;
      }
    } catch (err) {
      console.log(err)
      const div = document.getElementById("nca");
      div.innerHTML += `<h1>No chapters available</h1>`;
    }
  }
</script>

<body onload="changeDivContent()">
  <div class="topnav" id="myTopnav">
    <a href="/home"><i class="fa-solid fa-house"></i> Home</a>
    <a href="/explore" class="active"><i class="fa-solid fa-magnifying-glass"></i> Explore</a>

    <a id="account" href="#"><i class="fa-solid fa-user"></i> My Account</a>
    <a id="toggle" href="#"><i class="fa-solid fa-arrow-right-from-bracket"></i> Sign Out</a>

    <a href="https://cash.app/$PerezDeDios" target="_blank"><i class="fa-solid fa-coins"></i> Donate</a>
    <a href="javascript:void(0);" class="icon" onclick="myFunction()">
      <i class="fa-solid fa-bars"></i>
    </a>
  </div>

  <script>
    function myFunction() {
      var x = document.getElementById("myTopnav");
      if (x.className === "topnav") {
        x.className += " responsive";
      } else {
        x.className = "topnav";
      }
    } 
  </script>

  <script>
    document.getElementById("toggle").addEventListener("click", async (e) => {
      if (e.target.innerText === " Sign Out") {
        alert("Signing you out!");
        localStorage.removeItem("user");
        window.location.reload();
      }
    });  
  </script>

  <script>
    if (typeof Storage !== "undefined") {
      if (localStorage.user) {
        let data = JSON.parse(localStorage.user);
        document.getElementById("account").href = `/profile/${data.id}`;
      } else {
        document.getElementById("toggle").innerHTML = '<i class="fa-solid fa-right-to-bracket"></i> Sign In';
        document.getElementById("toggle").href = "/access-portal";
      }
    } else {
      document.getElementById("toggle").innerHTML = "<span>&empty;</span>";
      document.getElementById("account").innerHTML = "<span>&empty;</span>";
    }  
  </script>

  <div class="mid"
    style="max-width: 100%; height: 500px; background-image: url('$$icon$$'); background-size: contain; background-position: center;">
  </div>

  <div class="container">
    <div class="rounded-box">
      <div class="content">
        <p class="left-text">Views</p>
        <p class="right-text">$$views$$</p>
      </div>
    </div>
    <div class="rounded-box">
      <div class="content">
        <p class="left-text">Status</p>
        <p class="right-text">$$status$$</p>
      </div>
    </div>
    <div class="rounded-box">
      <div class="content">
        <p class="left-text">Favorites</p>
        <p class="right-text">$$favorites$$</p>
      </div>
    </div>
    <div class="text-container">
      <h2 class="title">$$name$$</h2>
      <p class="description">$$desc$$</p>
    </div>
    <div class="text-inline">
      <h1 class="fieldName">Author</h1>
      <p class="fieldValue"><a href="/profile/$$authorID$$">$$author$$</a></p>
      <h1 class="fieldName">Tags</h1>
      <p class="fieldValue">$$tags$$</p>
      <h1 class="fieldName">Published</h1>
      <p class="fieldValue">$$published$$</p>
      <h1 class="fieldName">Updated</h1>
      <p class="fieldValue">$$updated$$</p>
    </div>
    <button class="favorite-button" id="fb">
      <span><i class="fa-solid fa-star"></i></span>
      <span class="favtext">Add to favorites</span>
    </button>
  </div>

  <div id="error" class="alert">
    <span class="closebtn" onclick="this.parentElement.style.display='none';">&times;</span>
    Error.
  </div>

  <div id="success" class="alert success">
    <span class="closebtn" onclick="this.parentElement.style.display='none';">&times;</span>
    <strong>Success!</strong> Yay.
  </div>

  <script>
    const button = document.getElementById("fb");
    let data = JSON.parse(localStorage.user);
    button.addEventListener("click", async (_) => {
      if (!data) {
        e.preventDefault();
        error.innerHTML = `<span class="closebtn" onclick="this.parentElement.style.display='none';">&times;</span>
  Sign-In to favorite!`;
        error.style.display = "block";
      } else {
        const response = await fetch("/follow-book", {
          method: "POST",
          headers: {
            "Content-Type": "application/json",
          },
          body: JSON.stringify({
            token: data.token,
            follow: "$$name$$",
          }),
        });

        if (response.ok) {
          // Display success message here
          let user = JSON.parse(localStorage.user);
          let bookData = await fetch($$novel$$);
          let json = await bookData.json();
          if (json.followers.includes(user.id)) {
            button.innerHTML = `<span><i class="fa-regular fa-star"></i></span>
  <span class="favtext">Remove from favorites</span>`;
          } else if (!json.followers.includes(user.id)) {
            button.innerHTML = `<span><i class="fa-solid fa-star"></i></span>
      <span class="favtext">Add to favorites</span>`;
          }
          const successData = await response.json();
          success.innerHTML = `<span class="closebtn" onclick="this.parentElement.style.display='none';">&times;</span>
<strong>Success!</strong> ${successData.success}`;
          success.style.display = "block";
        } else {
          const errorData = await response.json();
          error.innerHTML = `<span class="closebtn" onclick="this.parentElement.style.display='none';">&times;</span>
${errorData.error}`;
          error.style.display = "block";
        }
      }
    });
  </script>

  <div id="nca" class="text"></div>

  <div id="chapters" class="btn-group"></div>
</body>

</html>